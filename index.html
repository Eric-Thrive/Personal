
import React, { useState } from "react";
import { toast } from "@/components/ui/use-toast";
import { AnalyzedWord } from "@/services/phonemeService";
import { analyzeWordsClient } from "@/services/phonemeClientService";
import PhonemeInput from "@/components/phoneme-analyzer/PhonemeInput";
import PhonemeResult from "@/components/phoneme-analyzer/PhonemeResult";
import HtmlExporter from "@/components/phoneme-analyzer/HtmlExporter";

const PhonemeAnalyzer = () => {
  const [inputWords, setInputWords] = useState("");
  const [analyzedWords, setAnalyzedWords] = useState<AnalyzedWord[]>([]);
  const [isAnalyzing, setIsAnalyzing] = useState(false);

  const handleAnalyze = async () => {
    const wordsToAnalyze = inputWords
      .split(',')
      .map(word => word.trim())
      .filter(word => word !== '');

    if (wordsToAnalyze.length === 0) {
      toast({
        title: "Input Required",
        description: "Please enter words to analyze.",
        variant: "destructive",
      });
      return;
    }

    setIsAnalyzing(true);
    try {
      // Directly use the client-side implementation
      const results = await analyzeWordsClient(wordsToAnalyze);
      
      setAnalyzedWords(results);
      toast({
        title: "Analysis Complete",
        description: `Successfully analyzed ${results.length} words.`,
      });
    } catch (error) {
      console.error("Error analyzing words:", error);
      toast({
        title: "Analysis Failed",
        description: error instanceof Error ? error.message : "Failed to analyze words",
        variant: "destructive",
      });
    } finally {
      setIsAnalyzing(false);
    }
  };

  return (
    <div className="min-h-screen bg-gray-100 py-8 px-4">
      <div className="max-w-3xl mx-auto bg-white rounded-xl shadow-md p-6">
        <h1 className="text-3xl font-bold text-center mb-6">Word Phoneme Analyzer</h1>
        
        <PhonemeInput 
          inputWords={inputWords}
          setInputWords={setInputWords}
          handleAnalyze={handleAnalyze}
          isAnalyzing={isAnalyzing}
        />

        {analyzedWords.length > 0 && (
          <div className="mt-8">
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-xl font-semibold">Analyzed Words:</h2>
              <HtmlExporter analyzedWords={analyzedWords} />
            </div>
            
            <PhonemeResult analyzedWords={analyzedWords} />
          </div>
        )}
      </div>
    </div>
  );
};

export default PhonemeAnalyzer;
